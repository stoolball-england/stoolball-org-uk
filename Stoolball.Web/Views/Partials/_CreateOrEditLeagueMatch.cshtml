@model EditLeagueMatchViewModel
@using Stoolball.Web.Matches
@Html.AntiForgeryToken()
@Html.ValidationSummary(true)

@if (Model.PossibleSeasons.Count == 1)
{
    @Html.HiddenFor(m => Model.Match.Season.SeasonId)
}
else
{
    <div class="form-group">
        @Html.LabelFor(m => Model.Match.Season.SeasonId)
        @Html.DropDownListFor(m => Model.Match.Season.SeasonId, Model.PossibleSeasons, new { @class = "form-control", required = "required", aria_describedby = "match-season" })
        @Html.ValidationMessageFor(m => Model.Match.Season.SeasonId, null, new { id = "match-season" })
    </div>
}

<div class="form-group">
    @Html.LabelFor(m => Model.MatchDate)
    @Html.TextBoxFor(m => Model.MatchDate, "{0:yyyy-MM-dd}", new { @type = "date", @class = "form-control", required = "required", aria_describedby = "match-date" })
    @Html.ValidationMessageFor(m => Model.MatchDate, null, new { id = "match-date" })
</div>

<div class="form-group">
    @Html.LabelFor(m => Model.StartTime)
    @Html.TextBoxFor(m => Model.StartTime, "{0:HH:mm}", new { @type = "time", @class = "form-control", aria_describedby = "start-time" })
    @Html.ValidationMessageFor(m => Model.StartTime, null, new { id = "start-time" })
</div>

<div class="form-group">
    @Html.LabelFor(m => Model.HomeTeamId)
    @Html.DropDownListFor(m => Model.HomeTeamId, Model.PossibleTeams, new { @class = "form-control", required = "required", aria_describedby = "home-team" })
    @Html.ValidationMessageFor(m => Model.HomeTeamId, null, new { id = "home-team" })
</div>

<div class="form-group">
    @Html.LabelFor(m => Model.AwayTeamId)
    @Html.DropDownListFor(m => Model.AwayTeamId, Model.PossibleTeams, new { @class = "form-control", required = "required", aria_describedby = "away-team" })
    @Html.ValidationMessageFor(m => Model.AwayTeamId, null, new { id = "away-team" })
</div>

<div class="form-group related-item">
    @Html.LabelFor(m => Model.MatchLocationName)
    @if (Model.MatchLocationId.HasValue)
    {
        <div class="related-item__selected">
            <div class="related-item__selected__section">
                @Html.TextBoxFor(m => Model.MatchLocationName, new { @class = "form-control", @readonly = "readonly" })
            </div>
            <div class="related-item__delete related-item__selected__section">
                @Html.HiddenFor(m => Model.MatchLocationId, new { @class = "related-item__data related-item__id" })
                <button class="text-danger">@Html.Partial("_DeleteIcon", (Model.MatchLocationId.Value.ToString(), $"Remove {Model.MatchLocationName} from this match"))</button>
            </div>
        </div>
        Model.MatchLocationName = string.Empty;
        @Html.TextBoxFor(m => Model.MatchLocationName, new
        {
            @class = "form-control related-item__search",
            placeholder = "Type the ground or sports hall name",
            autocomplete = "off",
            type = "search",
            data_url = "/api/locations/autocomplete",
            data_template = "location-template",
            aria_label = "Type a ground or sports hall name add and press down arrow to select from the matching choices",
            disabled = "disabled"
        })
    }
    else
    {
        @Html.TextBoxFor(m => Model.MatchLocationName, new
        {
            @class = "form-control related-item__search",
            placeholder = "Type the ground or sports hall name",
            autocomplete = "off",
            type = "search",
            data_url = "/api/locations/autocomplete",
            data_template = "location-template",
            aria_label = "Type a ground or sports hall name add and press down arrow to select from the matching choices"
        })
    }
</div>
<script type="text/x-template" id="location-template">
    <div class="related-item__selected">
        <div class="related-item__selected__section">
            <input type="text" readonly="readonly" value="{{value}}" class="form-control" id="MatchLocationName" name="MatchLocationName" />
        </div>
        <div class="related-item__delete related-item__selected__section">
            <input name="MatchLocationId" class="related-item__data related-item__id" type="hidden" value="{{data}}" />
            <button class="text-danger">@Html.Partial("_DeleteIcon", ("{{data}}", "Remove {{value}} from this match"))</button>
        </div>
    </div>
</script>

<div class="form-group">
    @Html.LabelFor(m => Model.Match.MatchNotes)
    @Html.TextAreaFor(m => Model.Match.MatchNotes, new { @class = "form-control", aria_describedby = "notes-validation" })
    @Html.ValidationMessageFor(m => Model.Match.MatchNotes, null, new { id = "notes-validation" })
</div>