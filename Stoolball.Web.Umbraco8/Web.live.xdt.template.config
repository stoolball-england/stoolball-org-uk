<?xml version="1.0"?>
<!--
  This transform is applied to web.config when the project is deployed to the live environment in Umbraco Cloud.
    
  For more info about how to transform on deployment: https://our.umbraco.com/documentation/Umbraco-Cloud/Set-Up/Config-Transforms/

  The configSections transforms ensure it's the first child of <configuration />: http://stackoverflow.com/questions/18737022/xdt-transform-insertbefore-locator-condition-is-ignored
-->
<configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform">
  <system.webServer xdt:Transform="InsertIfMissing" />
  <system.webServer>
    <modules xdt:Transform="InsertIfMissing" />
    <modules>
      <remove name="RedirectBareDomainModule" xdt:Transform="InsertIfMissing" xdt:Locator="Match(name)" />
      <add name="RedirectBareDomainModule" type="Stoolball.Web.Routing.RedirectBareDomainModule, Stoolball.Web" xdt:Transform="InsertIfMissing" xdt:Locator="Match(name)" />
      <remove name="RedirectsModule" xdt:Transform="InsertIfMissing" xdt:Locator="Match(name)" />
      <add name="RedirectsModule" type="Skybrud.Umbraco.Redirects.Routing.RedirectsModule, Skybrud.Umbraco.Redirects" xdt:Transform="InsertIfMissing" xdt:Locator="Match(name)" />
    </modules>
    <rewrite xdt:Transform="InsertIfMissing" />
    <rewrite>
      <rules xdt:Transform="InsertIfMissing" />
      <rules>
        <rule name="Domain" stopProcessing="true" xdt:Locator="Match(name)" xdt:Transform="InsertIfMissing">
          <match url="(.*)" />
          <conditions>
              <add input="{HTTP_HOST}" pattern="^www\.stoolball\.net$" ignoreCase="true" />
          </conditions>
          <action type="Redirect" url="https://www.stoolball.org.uk/{R:1}" redirectType="Permanent" />
        </rule>
      </rules>
    </rewrite>
  </system.webServer>
</configuration>